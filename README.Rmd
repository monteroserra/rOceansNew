---
tittle: rOceansNew - Examples
author: I. Montero-Serra
date: 05/Jul/2018
output: html_document
---

# rOceans 
An R Package for exploring spatial trends in marine biodiversity and conservation. Here
have examples of functions to access and explore spatial patterns of marine biodiversity. 
The functions are separated in set #1 for single or few species analyses and set #2 for
analyzing large data sets downloaded from OBIS or GBIF. 

*Currently, working on further set of functions to access and explore spatial data on climate change and other stressors as well as MPAs coverage. 

(1) Download rOceansNew from GitHub and load the package
```{r}

devtools::install_github("monteroserra/rOceansNew")
library(rOceansNew)

```

# Functions 1: 
## Accessing, merging and cleaning geographich occurrences data 

### Function 1.1 *oceanDivDat* 
Allows accessing occurrence data from GBIF and OBIS for a given vector of species names. It also allows merging data from these two sources and removing duplicates as well as land-based occurrences. 


```{r}

# Define target species names: example with three corals
coral_species = c("Corallium rubrum", "Acropora palmata", "Paramuricea clavata")

# Get, merge and filter occurrences using oceanDivDat()

corals = oceanDivDat(species_names = coral_species,
                     data_source = "OBIS_&_GBIF", 
                     remove_duplicates = T, 
                     remove_land_dots = T)

```

## Function 1.2 *oceanDataCheck* 
Allows merging, checking, filtering the raw data from OBIS and/or GBIF into a common standard database. 

For this set of functions, first we need to access and download data from GBIF (www.gbif.org) and OBIS (www.iobis.org). Here I show an example with data of species within the genus *Acropora* downloaded from the website on June 2018. The data can be accessed from my GitHub repository "monteroserra/rOceanData" or using data()



```{r}
# Example of direct downloaded raw occurrences of Acropora species from GBIF and OBIS

data(Acropora_GBIF) 
data(Acropora_OBIS)

Acropora_OBIS_checked = oceanDataCheck(OBIS_occurrences = Acropora_OBIS, source = "OBIS")

Acropora_GBIF_checked = oceanDataCheck(GBIF_occurrences = Acropora_GBIF, source = "GBIF")

Acropora_Total_Checked = oceanDataCheck(GBIF_occurrences = Acropora_GBIF,
                                        OBIS_occurrences = Acropora_OBIS,
                                        source = "GBIF_&_OBIS")

```

# Functions 2: analyzing spatial trends in marine biodiversity

## Function 2.1 *oceanAbundGrid* 
Allows creating global or delimited spatial grids with abundance
of occurrences per cell at differenc cell sizes. 

```{r}
# Computing global rasters of abundance

Acropora_abundance = oceanAbundGrid(occurrences = Acropora_Total_Checked, cell_size=5)

oceanMaps(Acropora_abundance, logScale=T, main="Acropora abundance")

```

## Function 2.2 *oceanMaps*  
A versatile data mapping tool for a rapid visualization of marine biodiversity patterns previously computed.  

```{r}
# Rapid visualization

oceanMaps(Acropora_abundance, logScale=T, main="Acropora abundance")

```


## Function 2.3 *oceanDiversity* 
Allows computing several diversity metrics (shannon, richness, simpson) at global scale or for specifically delimited areas. 

```{r}

# Computing global rasters of diversity metrics: example shannon diversity of Acropora species

Acropora_div = oceanDiversity(occurrences = Acropora_Total_Checked)

Acropora_species_matrix = Acropora_div[[1]]

Acropora_richness = Acropora_div[[2]]
Acropora_simpson = Acropora_div[[3]]
Acropora_shannon = Acropora_div[[4]]


oceanMaps(Acropora_richness, logScale=T,main="Acropora Species Richness")
oceanMaps(Acropora_shannon, logScale=T,main="Acropora Shannon Diversity")
oceanMaps(Acropora_simpson, logScale=T,main="Acropora Simpson Diversity")


```


# Functions 3: 
## Accessing and exploring current and future environmental data (in progress). 


## Function 3.1 *oceanEnv* 
Allows accessing environmental layers at present conditions to explore and test potential
drivers of marine biodiversity patterns

```{r}

# Using the previous example on abundance and diversity of Acropora species

# Computing abundance grids
data(Acropora_GBIF)
data(Acropora_OBIS)

#Check, merge and filter
Acropora_Total_Checked = oceanDataCheck(GBIF_occurrences = Acropora_GBIF,
                                        OBIS_occurrences = Acropora_OBIS,
                                        source = "GBIF_&_OBIS")
#Compute abundance grid
Acropora_abundance = oceanAbundGrid(occurrences = Acropora_Total_Checked, cell_size=5)

#Visualize abundance
oceanMaps(Acropora_abundance, logScale=T, main="Acropora abundance")

# getting envioronmental parameters and linking them to biodiversity patterns
abundance_environ_df = oceanEnv(biod_grid = Acropora_abundance,
                       biodiv_metric = "abundance", 
                       plot=T, 
                       log_scale=T)
  
# to see the full list of avilable parameters (326)

env_variables = sdmpredictors::list_layers()
marine_layers = env_variables[env_variables$marine==T, ]

# you can specify alternative environmental parameters using env_parameters


```


## Function 3.2: *oceanFuture*
Allows accessing, analyzing and mapping future trends in temeperature and other environmental parameters according to different IPCC scenarios

```{r}
# Accessing and mapping expected increases in Sea Surface Temperature data for 2100 according
# to different IPCC scenarios

SST_2100_RCP8.5 = oceanFuture()
SST_2100_RCP4.5 = oceanFuture(IPCC_scenario = "RCP45")
SST_2100_RCP2.5 = oceanFuture(IPCC_scenario = "RCP26")



# you can check other available enviornmental parameters with avaialable future projections

env_variables_future = sdmpredictors::list_layers_future()

#Ex Maximum Surface Salinity
Surface_Salinity_max_2100_RCP8.5 = oceanFuture(env_parameter = "BO2_salinitymax_ss")

#IPCC RCP4.5
Surface_Salinity_max_2100_RCP2.5 = oceanFuture(env_parameter = "BO2_salinitymax_ss", 
                                               IPCC_scenario = "RCP45")



#Ice thick
Ice_thick_trends_2100_RCP8.5 = oceanFuture(env_parameter = "BO2_icethickmax_ss")


```




